Heading:qjk40(635)Spruce protocol changesy756qjk40Page Numbers: Yes  X: 527  Y: 10.5"qjk40Inter-Office Memorandumz18592l4445y762\f5bTo	Spruce Interest	Date	September 11, 1979z18592l4445d2998e21(0,65535)(1,4445)(5,11684)(6,14146)\f1 2f0t2 1t0 15t6 1f1t0 4f0t7 1t0From	Rick Tiberi	Location	Palo Altoz18592l4445d2998y716e25\f1 4f0t2 1t0 11t6 1f1t0 8f0t7 1t0Subject	Spruce protocol changes	Organization	XBS/ASDz18592l4445d2998e25\f1 7f0t2 1t0 23t6 1f1t0 12f0t7 1t0XEROX       z18592l508y644e14(2116)\f2 5f0Filed on: [Ivy]<Spruce>SpruceProtocolChanges.memoz16095e12jk40z16095e12jk40The protocols and file format for transmitting press files to a Spruce server have been extended to allow increased control over printing by the client.  The extensions have been made in such a way as to allow compatability between old and new versions of both the client and server software.  Two major areas are affected: the status protocol ("Ears" socket) now allows additional request types, and additional pages may be appended to the front of a transmitted file, specifying print-instance parameters.z16095e12jk40\481i14IIt is also now possible to interrogate the status of a previously sent print request, by means of an id number sent with the request.  The PrinterCapabilityReply packet described below serves as a source of unique id's, which may be included in the print-instance parameters sent with the print request.  If the client sends the same id at a later time in a JobStatusRequest, the server will return the status of the job.z16095e12jk40\101i2IStatus Socketz16095e12jk40\f5b13f0BSpruce will respond on the status socket whether it is printing or spooling.  However, because of the limited space in the printer code, during printing only the PrinterStatusRequest packet will be answered. (It may be necessary to send several such requests before receiving a reply.)  The most important implication of this is that, while the server is printing, it is impossible for a client to determine whether the server will accept print-instance parameters, and no job id can be obtained.z16095e12jk40>  A packet of typePrinterStatusRequest (#200) will, as before, elicit a response packet of type PrinterStatusReply (#201) which contains:z16095e12jk40word 1: statusz16095l4269e12jk40=1	-- unavailablez16095l4269jk40=2	-- spooling and waitingz16095l4269jk40=3	-- spooling, but currently busy (printing or spooling another file).z16095l5152d4269jk40word 2 through end of packet: a string suitable for display to the user at the client machine, describing the status word above.z16095l5184d4269e12jk40>  Sending a PrinterCapabilityRequest (#202) returns a PrinterCapabilityReply (#203) which is in the form of a property-list which may contain the following properties:z16095e12jk40(DUPLEX	TRUE|FALSE)	-- can print two-sidedz16095l11136d4269e12jk40(0,7776)(1,10624)(5,65535)(6,65535)(COLOR	TRUE|FALSE)	-- can print in colorz16095l11136d4269jk40(MAILBOX	TRUE|FALSE)	-- sorter is in use for mailboxingz16095l11136d4269jk40(PRINT-INSTANCE	TRUE|FALSE)	-- will | will not accept print-instance parametersz16095l11136d4269jk40(ID number)	-- a double-word (32-bit) number which is a unique id suitable for inclusion as the job id in the print-instance parameters (represented in decimal).z16095l8192d4269jk40z16095l8192d4269jk40> To request the status of a previously sent job, the client should send a JobStatusRequest (#204).  Words 1 and 2 are the double-length ID sent with a previous job.  The server returns a JobStatusReply (#205) which is in the form of a property-list.  It may contain the following properties:z16095e12jk40(2116)(ID number)	-- the ID sent with the requestz16095l11136d4269e12jk40(0,7776)(STATUS string)	-- a string suitable for display to the client user, describing the status of the job (waiting, printed, waiting password, etc.)z16095l8256d4269jk40Transmitted File.z16095e12jk40(2116)\f5b17f0BSpruce will now accept additional pages appended to the front of a transmitted press file, which contain informtion about how the press file is to be handle.  These pages are identified by a password in the first 2 words of each such page (#125314 | #170377).  The remainder of the page is interpreted as a property-list, with the following properties accepted:z15990e12jk40(ID number)	-- the id to be associated with this print job for future reference; should be an id received in a PrinterCapabilityReply.z16095l8992d4269e12jk40(0,8608)(PRINTED-FOR string)	-- the name of the recipient of the hardcopy; used by mailboxing feature, and appears on the break page.z16095l8992d4269e6jk40(PRINTED-BY string)	-- the name of the client user, to be used in lieu of modifying the creator name in the document directoryz16095l8992d4269e6jk40(DUPLEX TRUE|FALSE)	-- print this file duplex | simplex.z16095l8992d4269e6jk40(HOLD string)	-- string is a password which must be entered at the server workstation before the job will print.z16095l8992d4269e6jk40(FILE-BYTES number)	-- the length of the file, in bytes; if this is too big for the spool file, the server will reject the file immediately, rather than waiting for the entire file to be sent.z16095l8992d4269e6jk40(COPIES number)	-- the number of copies of the document to print; overrides the document directory.z16095l8992d4269e6jk40Any number of such pages may be included, with each page being a separate and complete property-list.z16095l3008d2999e6jk40(0,7776)