-- File:  Press.mesa: Mesa version of Presse1(1792)\i-- Last Edited:  March 5, 1982  5:24 PM   By:  GWilliams e1\i--Added call to GetBitsFromBandse1\2i31IDIRECTORYe1AltoRam USING[LoadRamAndBoot],l4269d3634e1ImageDefs USING [StopMesa],l4269d3634e1IODefs USING[--CR, NUL, SP, TAB, ReadChar, WriteChar, WriteString,-- WriteLine],l3634e1k72(635)\13i55IPressDefs USING [copies, filePtr, Init, LockNeededCode, numPages, pageGarray, PrintInit, PSlot, ReadCommandFile],l4269d3634e1(1792)PressNetDefs USING [GetBits, GetBitsFromBands],l4269d3634e1SystemDefs USING [FreeHeapNode],l4269d3634e1TridentDefs USING [PAGE, tfsdskPtr, TfsCloseDisk, VDA];l4269d3634e1l4269d3634e1l4269d3634e1Press: PROGRAM	IMPORTS AltoRam, ImageDefs, IODefs, PressDefs, PressNetDefs, SystemDefs, TridentDefs	EXPORTS PressDefs =BEGIN OPEN AltoRam, IODefs, PressDefs, PressNetDefs, SystemDefs, TridentDefs;serverMode: PUBLIC BOOLEAN _ FALSE;uCodeLoaded: PUBLIC BOOLEAN _ FALSE;readBandsFile: PUBLIC BOOLEAN _ FALSE;abortFile: PUBLIC ERROR=CODE;l2999e1k72(635)\b5B308b10BMPress: PROC[] ={	bitPageNumber: CARDINAL;	continue: BOOLEAN;	disk: tfsdskPtr;	firstDa: PAGE;	firstVDA: VDA;	i: CARDINAL;	j: INTEGER;	slotAndTridentBlv: WORD = 77764B;		--let SLOT and Trident tasks run	WriteLine["Bit Flinger"];	DO	copies _ 1;	IF ~ReadCommandFile[] THEN GOTO done;	--ReadCommandFile exits if serverMode=TRUE	SELECT TRUE FROM	   serverMode =>		{IF ~GetBits[] THEN GOTO done;	--get a press.bits over the net & put on Trident	 	LoadRamAndBoot["MesaSlotMc.br", TRUE]};		--reboot machine to stop ethernet drivers.  	   readBandsFile =>		{IF ~GetBitsFromBands[] THEN GOTO done;		 --Try not loading the ram and booting here since ethernet was never on		};	   ENDCASE;	[disk, firstVDA, continue]_Init[];		--load global settings from Press.state and open trident	IF ~continue THEN GOTO done;	bitPageNumber _ pageGarray[0].BitPage;	--for debugging	firstDa _ LOOPHOLE [firstVDA];	WriteLine["Printing"];	LockNeededCode[];	--Lock in code we're going to need forever	FOR j IN[1..copies]	DO		PrintInit[! abortFile => GOTO done];	--inits the printing engine		FOR i IN [0..numPages)			DO			PSlot[disk, @pageGarray[i], (IF ((i=numPages-1) AND (j=copies)) THEN TRUE ELSE FALSE), --i.e., laspage&lastcopy--			        firstDa, filePtr! abortFile => GOTO done--bail out for now--];			ENDLOOP;	ENDLOOP;--Clean up	FreeHeapNode[pageGarray];	[]_TfsCloseDisk[disk, TRUE];	--free ddMgr	IF ~serverMode THEN EXIT;	ENDLOOP;EXITSdone => NULL;l2999e1k72(0,3648)(1,4269)(2,4904)(3,9888)\b6B173i30I85i42I70i48I47i40I1i2I24i112I19i1I37i56I72i15I76i43I65i27I122i38I42i18I24i13I56i12I60i};--Procedure Press--Mainline code	MPress[];	ImageDefs.StopMesa[];	--put into main program later.l2999e1k72(635)\4i16I4i14I12f1 10f0 11iEND. -- Pressl2999e1k72\i1I5i3I-- Last Edited:  October 26, 1981  3:39 PM   By:  GWilliams e1(1792)\i--changed to become a "server"-- Last Edited:  October 27, 1981  1:38 PM   By:  GWilliams e1\2i--added copies loop-- Last Edited:  October 28, 1981  11:02 AM   By:  GWilliams e1\2i--added term to evaluation of LastPage (an arg of PSlot)-- Last Edited:  November 4, 1981  4:13 PM   By:  GWilliams e1\2i--added WriteLine of "BitFlinger"(635)\2i32I